/*! weatherwise - v1.0.0 - 2019-03-22 */

$.ajax({url:"../config.json",dataType:"json",type:"get",success:function(e){skyKey=e[0].SKY,getSkyData()},error:function(e){console.log(e),console.log("Error getting key...")}});var skyKey,dateStamp,finalDateStamp,currentTemp,currentIcon,countDown,getHumidity=document.getElementById("data__humidity"),getUv=document.getElementById("data__uvIndex"),getWind=document.getElementById("data__windGust"),getTime=document.getElementById("data__time"),getHannah=document.getElementById("data--extra-bg"),getformattedRiseTime=document.getElementById("data__time--sunrise"),getformattedSetTime=document.getElementById("data__time--sunset"),getCountdown=document.getElementById("countdown__div"),body=document.body,myLat=-41.2865,myLng=174.7762,input=document.getElementById("search--text--field"),now=new Date,days=new Array("SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"),months=new Array("January","Febuary","March","April","May","June","July","August","September","October","November","December"),getTopTemp=document.getElementById("top--temp"),getTopLocation=document.getElementById("top--location"),getCurrentTemp=document.getElementById("data--current--temp"),getCurrentTempHigh=document.getElementById("data--current--temp-high"),getCurrentTempLow=document.getElementById("data--current--temp-low"),getCurrentDesc=document.getElementById("data--current--desc"),getCurrentIcon=document.getElementById("data--current--icon"),getCurrentDate=document.getElementById("data--current--date"),getLocationDiv=document.getElementById("data--location--div"),getLocation=document.getElementById("data--location"),getSearchFieldDiv=document.getElementById("search--text--field--div"),getSearchField=document.getElementById("search--text--field"),getSearchButton=document.getElementById("search--button"),getPowerButton=document.getElementById("power--button"),getDailyBG=document.getElementById("data--daily-bg"),getDailyDate=document.getElementById("data--daily--date"),getDailyTemp=document.getElementById("data--daily--temp"),getDailyTempLow=document.getElementById("data--daily--temp-low"),getDailyIcon=document.getElementById("data--daily--icon"),makeDiv=document.createElement("div");function getSkyData(){$("#master--loader").show(),$.ajax({url:"https://api.darksky.net/forecast/"+skyKey+"/"+myLat+","+myLng+"?units=si",dataType:"jsonp",type:"get",success:function(i){clearInterval(countDown),console.log(i),currentTemp=Math.trunc(i.currently.temperature),currentTempHigh=Math.trunc(i.daily.data[0].apparentTemperatureHigh),currentTempLow=Math.trunc(i.daily.data[0].apparentTemperatureLow),currentIcon=i.currently.icon,currentDesc=i.hourly.summary,getTopTemp.innerHTML='<p>Currently <span class="bold space">'+currentTemp+"°&nbsp;</h1>",getCurrentTemp.innerHTML='<h1 class="bold space massive">'+currentTemp+"°</h1>",getCurrentDesc.innerHTML='<p>Feels like <span class="bold space">'+currentTemp+'°&nbsp;&nbsp;</span>High <span class="bold space">'+currentTempHigh+'°&nbsp;&nbsp;</span>Low <span class="bold space">'+currentTempLow+"°</span></p><h3>"+currentDesc+"</h3>",body.classList.remove("bckgd--lb","bckgd--g","bckgd--db","bckgd--y"),"clear-day"==currentIcon?(getCurrentIcon.innerHTML='<img class="icon--massive" src="icon/weather/clear-day.svg"><p class="marginBot">&nbsp;</p>',body.classList.add("bckgd--y"),$("#icon--info").hover(function(){$(".icon--info").tooltip(),changeTooltipColorTo("#ff9e3e")})):"clear-night"==currentIcon?(getCurrentIcon.innerHTML='<img class="icon--massive" src="icon/weather/clear-night.svg">',body.classList.add("bckgd--db"),$("#icon--info").hover(function(){$(".icon--info").tooltip(),changeTooltipColorTo("#0d3866")})):"rain"==currentIcon?(getCurrentIcon.innerHTML='<img class="icon--massive" src="icon/weather/rain.svg">',body.classList.add("bckgd--lb"),$("#icon--info").hover(function(){$(".icon--info").tooltip(),changeTooltipColorTo("#136999")})):"snow"==currentIcon?(getCurrentIcon.innerHTML='<img class="icon--massive" src="icon/weather/snow.svg">',body.classList.add("bckgd--db"),$("#icon--info").hover(function(){$(".icon--info").tooltip(),changeTooltipColorTo("#0d3866")})):"sleet"==currentIcon?(getCurrentIcon.innerHTML='<img class="icon--massive" src="icon/weather/sleet"><p class="marginBot">&nbsp;</p>',body.classList.add("bckgd--lb"),$("#icon--info").hover(function(){$(".icon--info").tooltip(),changeTooltipColorTo("#136999")})):"wind"==currentIcon?(getCurrentIcon.innerHTML='<img class="icon--massive" src="icon/weather/wind.svg">',body.classList.add("bckgd--g"),$("#icon--info").hover(function(){$(".icon--info").tooltip(),changeTooltipColorTo("#586980")})):"fog"==currentIcon?(getCurrentIcon.innerHTML='<img class="icon--massive" src="icon/weather/fog.svg">',body.classList.add("bckgd--g"),$("#icon--info").hover(function(){$(".icon--info").tooltip(),changeTooltipColorTo("#586980")})):"cloudy"==currentIcon?(getCurrentIcon.innerHTML='<img class="icon--massive" src="icon/weather/cloudy.svg"><p class="marginBot">&nbsp;</p>',body.classList.add("bckgd--g"),$("#icon--info").hover(function(){$(".icon--info").tooltip(),changeTooltipColorTo("#586980")})):"partly-cloudy-day"==currentIcon?(getCurrentIcon.innerHTML='<img class="icon--massive" src="icon/weather/partly-cloudy-day.svg">',body.classList.add("bckgd--g"),$("#icon--info").hover(function(){$(".icon--info").tooltip(),changeTooltipColorTo("#586980")})):"partly-cloudy-night"==currentIcon&&(getCurrentIcon.innerHTML='<img class="icon--massive" src="icon/weather/partly-cloudy-night.svg">',body.classList.add("bckgd--db"),$("#icon--info").hover(function(){$(".icon--info").tooltip(),changeTooltipColorTo("#0d3866")})),getDailyDate.innerHTML="",getDailyTemp.innerHTML="",getDailyTempLow.innerHTML="",getDailyIcon.innerHTML="",i.daily.data.shift();for(var e=0;e<i.daily.data.length;e++){dateStamp=i.daily.data[e].time;var t=new Date(1e3*dateStamp),n=t.getFullYear();month=t.getMonthFormatted(),day=t.getDayFormatted();var o=n+"-"+month+"-"+day;dailyDay=getDayOfWeek(o);var a=Math.trunc(i.daily.data[e].apparentTemperatureHigh),c=Math.trunc(i.daily.data[e].apparentTemperatureLow),r=i.daily.data[e].icon;getDailyDate.innerHTML+='<p class="data--daily">'+dailyDay+"</p>",getDailyTemp.innerHTML+='<p class="data--daily bold space">'+a+"°</p>",getDailyTempLow.innerHTML+='<p class="data--daily space">'+c+"°</p>",iconWrapper=document.getElementById("data--daily--icon-wrapper"),iconWrapper.appendChild(makeDiv),makeDiv.appendChild(getDailyIcon),"clear-day"==r?getDailyIcon.innerHTML+='<img class="icon--sml" src="icon/weather/clear-day.svg">':"clear-night"==r?getDailyIcon.innerHTML+='<img class="icon--sml" src="icon/weather/clear-night.svg">':"rain"==r?getDailyIcon.innerHTML+='<img class="icon--sml" src="icon/weather/rain.svg">':"snow"==r?getDailyIcon.innerHTML+='<img class="icon--sml" src="icon/weather/snow.svg">':"sleet"==r?getDailyIcon.innerHTML+='<img class="icon--sml" src="icon/weather/sleet.svg">':"wind"==r?getDailyIcon.innerHTML+='<img class="icon--sml" src="icon/weather/wind.svg">':"fog"==r?getDailyIcon.innerHTML+='<img class="icon--sml" src="icon/weather/fog.svg">':"cloudy"==r?getDailyIcon.innerHTML+='<img class="icon--sml" src="icon/weather/cloudy.svg">':"partly-cloudy-day"==r?getDailyIcon.innerHTML+='<img class="icon--sml" src="icon/weather/partly-cloudy-day.svg">':"partly-cloudy-night"==r&&(getDailyIcon.innerHTML+='<img class="icon--sml" src="icon/weather/partly-cloudy-night.svg">')}var l=(now.getDate()<10?"0":"")+now.getDate();currentDay=days[now.getDay()]+" ",currentMonth=months[now.getMonth()]+" "+l,getCurrentDate.innerHTML='<h2><span class="bold">'+currentDay+"&nbsp;</span>"+currentMonth+"</h2>",unix_timestamp=i.daily.data[0].sunriseTime;var s=new Date(1e3*unix_timestamp),d=s.getHours()+":"+("0"+s.getMinutes()).substr(-2);sunset_timestamp=i.daily.data[0].sunsetTime;var g=new Date(1e3*sunset_timestamp),m=g.getHours()+":"+("0"+g.getMinutes()).substr(-2);sunrise=Math.trunc(i.daily.data[0].sunriseTime),sunset=Math.trunc(i.daily.data[0].sunsetTime),getformattedRiseTime.innerHTML="<h1>"+d+"</h1>",getformattedSetTime.innerHTML="<h1>"+m+"</h1>";var u=i.daily.data[0].sunsetTime,p=new Date(1e3*u).toString().slice(0,24),y=new Date(p).getTime();countDown=setInterval(function(){var e=(new Date).getTime(),t=y-e,n=Math.floor(t%864e5/36e5),o=Math.floor(t%36e5/6e4),a=Math.floor(t%6e4/1e3);getCountdown.innerHTML="<h1>"+n+" : "+o+" : "+a+" </h1>",t<0&&(clearInterval(countDown),getCountdown.innerHTML="<h1>Expired</h1>")},1e3),humidity=(100*i.daily.data[0].humidity).toFixed(0),getHumidity.innerHTML="<h1>"+humidity+'<span class="ampm space"> %</span></h1>',uvIndex=i.daily.data[0].uvIndex,getUv.innerHTML="<h1>"+uvIndex+"</h1>",windGust=Math.round(i.daily.data[0].windGust),getWind.innerHTML="<h1>"+windGust+'<span class="ampm space"> km/h</span></h1>',google.charts.load("current",{packages:["corechart"]}),google.charts.setOnLoadCallback(function(){var e=new google.visualization.DataTable;e.addColumn("string","Day"),e.addColumn("number","Wind");for(var t=0;t<i.daily.data.length;t++){dateStamp=i.daily.data[t].time;var n=new Date(1e3*dateStamp),o=n.getFullYear();month=n.getMonthFormatted(),day=n.getDayFormatted();var a=o+"-"+month+"-"+day;dailyDay=getDayOfWeek(a),e.addRow([dailyDay,i.daily.data[t].windGust])}new google.visualization.AreaChart(document.getElementById("chart_div")).draw(e,{title:"WEEKLY WIND SPEED",indexLabel:"Poppins",titleTextStyle:{color:"#ffffff",fontSize:18,fontName:"Poppins",fontWeight:300,bold:!1},legend:"none",hAxis:{slantedText:!0,slantedTextAngle:90,textStyle:{color:"#ffffff",fontSize:9,fontName:"Poppins"}},vAxis:{textStyle:{color:"#ffffff",fontSize:12,italic:!1,fontName:"Poppins"}},backgroundColor:{color:"#ffffff",fill:"transparent"},colors:["#ffffff"],tooltip:{textStyle:{color:"#000000",fontName:"Poppins",fontSize:10}}})}),$("#master--loader").delay(350).fadeOut("slow")},error:function(e){console.log(e),console.log("Error getting data...")}})}function getDayOfWeek(e){var t=new Date(e).getDay();return isNaN(t)?null:["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"][t]}function removeWarning(){$(".locationWarning").click(function(){$(".search--text--field--div").tooltip("hide")})}function changeTooltipColorTo(e){$(".tooltip-inner").css("background-color",e)}function init(){var t=new google.maps.places.Autocomplete(input,{types:["(cities)"]});t.setFields(["geometry","name"]),google.maps.event.addListener(t,"place_changed",function(){var e=t.getPlace();myLat=e.geometry.location.lat(),myLng=e.geometry.location.lng(),getSkyData(),getLocation.innerHTML='<img class="icon--md" src="icon/ww-location.svg"><h2>'+input.value+"</h2>",getTopLocation.innerHTML="<p>"+input.value+"</p>"})}function validateSearchField(){return getSearchField.value.match(/([A-Z])\w+/)?($(".search--text--field--div").tooltip("hide"),getSkyData(),getLocation.innerHTML='<img class="icon--md" src="icon/ww-location.svg"><h2>'+input.value+"</h2>",getTopLocation.innerHTML="<p>"+input.value+"</p>",!0):($(".search--text--field--div").tooltip("show"),removeWarning(),!1)}function checkGeo(){navigator.geolocation.watchPosition(function(e){console.log("Geolocation success"),getGeoLocation()},function(e){e.code==e.PERMISSION_DENIED&&console.log("Geolocation access denied..."),myLat=-41.2865,myLng=174.7762,getSkyData()})}function getGeoLocation(){var a;navigator.geolocation.getCurrentPosition(function(e,t){var n;geo_loc=(n=e,html5Lat=n.coords.latitude,html5Lon=n.coords.longitude,html5TimeStamp=n.timestamp,html5Accuracy=n.coords.accuracy,html5Lat.toFixed(8)+", "+html5Lon.toFixed(8)),currLatLong=geo_loc.split(","),function(e,t){if(a=new google.maps.Geocoder,""!=e&&""!=t){var n=new google.maps.LatLng(e,t);return o=n,a.geocode({location:o},function(e,t){t==google.maps.GeocoderStatus.OK?$("#address").html(e[0].formatted_address):alert("No Geolocation Support "+t)})}var o}(currLatLong[0],currLatLong[1]),myLat=currLatLong[0],myLng=currLatLong[1],getSkyData()})}getLocation.innerHTML='<img class="icon--md" src="icon/ww-location.svg"><h2>Wellington, New Zealand</h2>',getTopLocation.innerHTML="<p>Wellington, New Zealand</p>",Date.prototype.getMonthFormatted=function(){var e=this.getMonth()+1;return e<10?"0"+e:e},Date.prototype.getDayFormatted=function(){var e=this.getDate();return e<10?"0"+e:e},$(document).ready(function(){$(".icon--info").tooltip({template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover",title:"<p>WeatherWise aims to prioritize<br>preparedness so that users<br>know how to best dress and<br>prepare for the weather</p>",html:!0,placement:"left",offset:"40, 15"})}),$(".search--text--field--div").tooltip({template:'<div class="tooltip locationWarning"><div class="tooltip-arrow"></div><div class="tooltip-inner red"></div></div>',trigger:"manual",title:"<p>Please enter a valid location...</p>",html:!0,placement:"top"}),google.maps.event.addDomListener(window,"load",init),getSearchButton.addEventListener("click",validateSearchField);